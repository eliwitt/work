<html>
  <head>
    <title>Using jQuery to call a Web service</title>
    <!-- CSS -->
<link rel="stylesheet" href="css/styles.css">
<link href='http://fonts.googleapis.com/css?family=Droid+Sans' rel='stylesheet' type='text/css'>
	<!-- Scripts -->
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
<script type="text/javascript">
$(document).ready(function(){

	var Servurl = 'http://localhost/VPIOrderService/OrderService.svc/';
	var SerTail = '';
	var $container  = $('#inner-container'),
	    $articles   = $container.children('article'),
	    timeout;

	$('#butOrder').click(function(){
		//alert('In event');
		if ($("#custno").val() == "")
		{
			var resultsField =  document.getElementById("inner-container");
			resultsField.innerHTML = "";
			$("#inner-container").append('<P>Customer is a required field for the service.</p>');
		}
		else
		{
			if($("#orderno").val() == "")
				SerTail = $("#custno").val();
			else
				SerTail = "Order/" + $("#custno").val() + "/" + $("#orderno").val();
			//alert('url ' + Servurl+SerTail);
			$.ajax({
				type: "GET",
				url: Servurl+SerTail,
				dataType: "xml",
				success: callback
			});
		}

	});

	$(document).on( 'mouseenter', 'article', function( event ) {

	    var $article = $(this);
	    clearTimeout( timeout );
	    timeout = setTimeout( function() {
	 
	        if( $article.hasClass('active') ) return false;
	 
	        $articles.not($article).removeClass('active').addClass('blur');
	 
	        $article.removeClass('blur').addClass('active');
	 
	    }, 75 );
	 
	});
	 
	$(document).on( 'mouseleave', 'article', function( event ) {
	    clearTimeout( timeout );
	    $(this).removeClass('active blur');
	 
	});
});

function callback(data, status)
{
	var custField =  document.getElementById("custno");
	var orderField =  document.getElementById("orderno");
	var resultsField =  document.getElementById("inner-container");
	resultsField.innerHTML = "";
	custField.value = "";
	orderField.value = "";
	//console.log(data);
	//alert('In callback ' + status);
	if (status == 'success')
	{
		var theOrders = data.getElementsByTagName("CustOrder");
		//console.log(theOrders);
    	listOrders(theOrders);
	} else {
		$("#inner-container").append('<h3>Error in calling service please contact support.</h3>');
	}

}

function listOrders (theOrders)
{
    var loopIndex;

    for (loopIndex = 0; loopIndex < theOrders.length; loopIndex++)
    {
    	var orNode = theOrders[loopIndex].getElementsByTagName("OrderNumber")[0];
    	var orLine = theOrders[loopIndex].getElementsByTagName("LineNumber")[0];
    	var po = theOrders[loopIndex].getElementsByTagName("PoNumber")[0];
    	var statusTxt = theOrders[loopIndex].getElementsByTagName("StatusText")[0];
    	$("#inner-container").append('<article><p>For order number ' + orNode.innerHTML + 
 			' the line nu is ' + orLine.innerHTML + ' with a po nu of ' + po.innerHTML +
            '</p><p class="client-name">' + statusTxt.innerHTML + '</p></article>');
    }
}

</script>
</head>
<body>
	<section class="container">
		<header>
		<h1>VPI jQuery Test Web Service</h1>
		<p>Customer number: <input type="text" id="custno" /> Order number: <input type="text" id="orderno" /> Get the customer's <input type="button" id="butOrder" value="Order Info" /></p>
		</header>
		<section id="inner-container" class="inner-container"/>
	
	</section>
</body>
</html>